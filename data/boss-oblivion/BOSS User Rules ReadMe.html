<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
	<title>BOSS User Rules ReadMe</title>
	<style type="text/css">
	#body {font-family:Calibri,Arial,Verdana,sans-serifs;}
	#title {font-size:2.4em; font-weight:bold; text-align: center;}
	div > span {font-weight:bold; font-size:1.3em;}
	.subtitle {font-weight: normal;font-size:1.3em;}
	.definition {text-indent:-1.4em; margin-left: 2.5em;}
	ol li {margin-bottom:10px;}
	ul li {margin-bottom:10px;}
	</style>
  </head>
	<body id="body">
	<div id="title">Better Oblivion Sorting Software</div>
	<div id="title">User Rules Documentation</div><br /><br />
	
	<div><span>Contents</span>
	<ol>
		<li><a href="#intro">Introduction</a></li>
		<li><a href="#start">Getting Started With The Userlist</a></li>
		<li><a href="#basics">Rule Basics</a></li>
		<li><a href="#syntax">Rule Definition Syntax</a></li>
		<li><a href="#apply">Enforcing Your Rules</a></li>
		<li><a href="#notes">Further Notes On Rules</a></li>
		<li><a href="#messsages">The BOSS Message Format</a></li>
		<li><a href="#bomm">Compatibility With BOSS Masterlist Manager (BOMM)</a></li>
	</ol>
	</div><br /><br />

	<div id="intro"><span>Introduction</span>
	<p style="color:red">NOTE: This readme is for features unique to the wrinklyninja-user-rules branch. It is an outline of the user rules implementation, 
	and is subject to change. Everything in this readme has been implemented, and is undergoing testing.
	Once everything is confirmed as working correctly, the branch will be merged into the trunk, and these features become a part of
	the official BOSS. <br />The one caveat to note that should hopefully change by the time that BOSS is released is that Wrye Bash will not automatically apply Bash
	Tag suggestions given to mods in rules.
	<br />-WrinklyNinja</p>
	<p>While BOSS is able to sort the large number of mods listed in its masterlist without any user input, you may find that you wish to customise 
	the sorting of your mods to a degree. This may be to include mods not listed in the masterlist (eg. temporary plugins or private mods that would 
	serve no benefit being in the masterlist), or it could be to rearrange mods present in the masterlist that can be loaded in a different configuration 
	for different results (eg. LAME and Supreme Magicka files). You may also wish to add extra messages to mods, or edit existing messages.</p>
	<p>One possible solution is to edit your copy of the masterlist to include the desired changes. However, as updating your masterlist will remove 
	these edits, this is not very suitable as a long term solution.</p>
	<p>This is where user rules comes in. Using a separate userlist file, you can define rules for sorting specific mods or groups of mods as you like, 
	as well as for adding or editing messages attached to mods, and these rules will not be lost when you update your masterlist.</p>
	</div><br /><br />
  
	<div id="start"><span>Getting Started With The Userlist</span>
	<p style="color:purple">NOTE: In this readme, the words 'mod' and 'plugin' are used interchangeably, meaning 'one individual file with a .esp or 
	.esm extension'. Unless explicitely stated, the 'name' of a 'mod' or 'plugin' refers to its filename, including the extension.<br /><br />
	Also, while the examples in this ReadMe are written for Oblivion, the functionality will work for Oblivion and Fallout 3. When your game's master .ESM file is mentioned, this refers to Oblivion.esm or Fallout3.esm for Oblivion or Fallout 3 respectively.</p>
	<p>The userlist is the file which contains your custom rules for sorting mods and editing mods' messages. It is found at <code>Data\BOSS\userlist.txt</code>. If it 
	does not exist, simply create a new text file there with the same name.</p>
	<p>Within this file, which you can open up in Notepad to edit, you list your rule definitions. Rules can make two types of changes:
	<ol class="list">
		<li><em>Sort mods or groups.</em> You can sort plugins relative to other plugins, or groups of plugins 
		relative to other groups of plugins. Plugins may be .esp or .esm files. Groups are all pre-defined in the BOSS masterlist, marked out by the 
		<code>\BeginGroup\:  <em>Group Name</em></code> and <code>\EndGroup\\</code> lines. You may override the positions of mods and groups in the 
		masterlist with new positions, and add new plugins to be sorted, but you cannot add new groups.</li>
		<li><em>Edit BOSS messages.</em> You can add to or replace the messages that are attached to mods in the masterlist and that are displayed in the BOSSlog.
		See <em>The BOSS Message Format</em> below for more details on the message types and syntax.</li>
	</ol>
	The rule definition syntax is simple and concise, and is explained below.</p>
	</div><br /><br />
	
	<div id="basics"><span>Rule Basics</span>
	<p>While it is strongly suggested that you read the <em>Rule Definition Syntax</em> section below to gain a proper understanding of user rules, here is a quick start guide for some simple rules.</p>
	<span class="subtitle">Adding A New Mod</span>
	<p>To sort a mod that is not in the masterlist after another mod:</p>
	<blockquote><code>
	ADD: &lt;RULE MOD&gt;<br />
	AFTER: &lt;SORT MOD&gt;
	</code></blockquote>
	<p>To sort it before another mod:</p>
	<blockquote><code>
	ADD: &lt;RULE MOD&gt;<br />
	BEFORE: &lt;SORT MOD&gt;
	</code></blockquote>
	<p>The <em>rule mod</em> is the mod you want to add, and the <em>sort mod</em> is the mod you want to sort it relative to (ie. it's position in your load order). Both mods must be installed in your Data directory.</p>
	<p>Some examples:</p>
	<blockquote><code>
	ADD: Mod1.esp<br />
	AFTER: AFK_Weye.esp<br /><br />
	ADD: Mod2.esp<br />
	BEFORE: AFK_Weye.esp
	</code></blockquote>
	<p>This gives a load order of:</p>
	<blockquote>
	...<br />
	Mod2.esp<br />
	AFK_Weye.esp<br />
	Mod1.esp<br />
	...
	</blockquote>
	
	<br /><span class="subtitle">Changing An Existing Mod's Position</span>
	<p>To sort a mod that is already in the masterlist after another mod:</p>
	<blockquote><code>
	OVERRIDE: &lt;RULE MOD&gt;<br />
	AFTER: &lt;SORT MOD&gt;
	</code></blockquote>
	<p>To sort it before another mod:</p>
	<blockquote><code>
	OVERRIDE: &lt;RULE MOD&gt;<br />
	BEFORE: &lt;SORT MOD&gt;
	</code></blockquote>
	<p>The <em>rule mod</em> is the mod you want to sort, and the <em>sort mod</em> is the mod you want to sort it relative to. Both mods must be installed in your Data directory. The mod will be moved from the place it is given in the masterlist to the place you specify.</p>
	<p>An example:</p>
	<blockquote><code>
	OVERRIDE: bgBalancingEVCore.esp<br />
	AFTER: Unofficial Oblivion Patch.esp
	</code></blockquote>
	<p>This gives a load order of:</p>
	<blockquote>
	...<br />
	Unofficial Oblivion Patch.esp<br />
	bgBalancingEVCore.esp<br />
	...
	</blockquote>
	
	<br /><span class="subtitle">Editing A Mod's BOSSlog Messages And Bash Tag Suggestions</span>
	<p>To add a message to a mod for display in the BOSSlog:</p>
	<blockquote><code>
	FOR: &lt;RULE MOD&gt;<br />
	APPEND: &lt;MESSAGE OBJECT&gt;
	</code></blockquote>
	<p>To replace the messages attached to a mod for display in the BOSSlog:</p>
	<blockquote><code>
	FOR: &lt;RULE MOD&gt;<br />
	REPLACE: &lt;MESSAGE OBJECT&gt;
	</code></blockquote>
	<p>The <em>rule mod</em> is the mod you want to add the message to. It must be installed in your Data directory. The <em>message object</em> is the formatted BOSS message that you want to attach. See the <em>The BOSS Message Format</em> section later on in this readme if you are unfamiliar with BOSS message formatting.</p>
	<p>An example:</p>
	<blockquote><code>
	FOR: Unofficial Oblivion Patch.esp<br />
	REPLACE: ? Overrided!<br /><br />
	FOR: bgMagicEV.esp.esp<br />
	APPEND: % {{BASH:Names,Delev,Relev}}
	</code></blockquote>
	<p>This will print in the BOSSlog:</p>
	<blockquote>
	<li style='list-style-type:none;'>...<ul></ul></li>
	<li style='list-style-type:none;'>
	Unofficial Oblivion Patch.esp<ul>
	<li>Note:  Overrided!</li>
	</ul></li>
	<li style='list-style-type:none;'>...<ul></ul></li>
	<li style='list-style-type:none;'>
	bgMagicEV.esp.esp<ul>
	<li>Bashed Patch tag suggestion:  % {{BASH:Names,Delev,Relev}}</li>
	</ul></li>
	<li style='list-style-type:none;'>...<ul></ul></li>
	</blockquote>
	</div><br /><br />
	
	<div id="syntax"><span>Rule Definition Syntax</span><br />
	<p>User rules have a specific structure and syntax which your rules must follow to be applied. The information below provides the details on this structure and syntax.</p>
	<br /><span class="subtitle">The Rule Line</span>
	<p>Every rule begins with a <em>rule line</em>, which has the structure:</p>
	<blockquote><code>&lt;RULE KEYWORD&gt;: &lt;RULE OBJECT&gt;</code></blockquote>
	<p>This is the <em>rule line</em>. The <em>rule keyword</em> can be one of:</p>
	<ul>
		<li><em>ADD</em>: This tells BOSS that the rule sorts a mod that is not in the 
		masterlist. The rule may also add messages to that mod.</li>
		<li><em>OVERRIDE</em>: This tells BOSS that the rule overrides the current position of a mod or group in the masterlist with a new position. 
		The rule may also edit attached messages.</li>
		<li><em>FOR</em>: This tells BOSS that the rule edits the messages attached to a mod, but does not sort it.</li>
	</ul>
	<p>The <em>rule object</em> is the mod or group that the rule is applied to. If the rule keyword is FOR, the rule object must be a mod. If the rule object is a mod, it must be installed in your Data folder.</p>
	<p>When you define groups, the names of those groups are used as they appear in the masterlist. For example, 
	if you wanted to reference the group of mods that begins with <code>\BeginGroup\: Supreme Magicka</code>, you would put it in the rule as 
	<code>Supreme Magicka</code>. You cannot reference the group containing all the ESM files, "ESMs", as groups can only be sorted, and this must always load first.</p>
	
	<br /><span class="subtitle">The Sort Line</span>
	<p>If a rule's rule keyword is ADD or OVERRIDE, it <b>must</b> include a <em>sort line</em>, which has the structure:</p>
	<blockquote><code>&lt;SORT KEYWORD&gt;: &lt;SORT OBJECT&gt;</code></blockquote>
	<p>The <em>sort keyword</em> can be one of:</p>
	<ul>
		<li><em>BEFORE</em>: This states that the rule object is to load immediately before the sort object.</li>
		<li><em>AFTER</em>: This states that the rule object is to load immediately after the sort object.</li>
	</ul>
	<p>The <em>sort object</em> is the plugin or group that you wish the rule object 
	to be positioned relative to. If the rule object is a mod, the sort object must also be a mod, and the same if the rule object is a group. Mods must be sorted relative to other mods, and groups must be sorted relative to groups. You cannot sort mods relative to groups, or vice versa. You also cannot sort groups before the group "ESMs".</p>
	<p>If the sort object is a mod, it must be installed in your Data folder. You cannot sort your game's master .ESM file. A rule with a FOR rule keyword <b>must not</b> include a sort line.</p>
	
	<br /><span class="subtitle">The Message Line</span>
	<p>If a rule's rule keyword is FOR, it <b>must</b> include at least one <em>message line</em>, which has the structure:</p>
	<blockquote><code>&lt;MESSAGE KEYWORD&gt;: &lt;MESSAGE OBJECT&gt;</code></blockquote>
	<p>The <em>message keyword</em> can be one of:</p>
	<ul>
		<li><em>APPEND</em>: This states that the message is to be appended to the list of messages attached to the rule mod.</li>
		<li><em>REPLACE</em>: This states that the message is to replace any existing message or messages attached to the rule mod.</li>
	</ul>
	<p>The <em>message object</em> is the message, complete with symbol code, that you wish to attach to the mod defined by the rule object. You cannot attach messages to groups.</p>
	<p>You may have multiple message lines in a rule, to add multiple messages to a mod, or to override an existing set of messages with a new set. Rules with ADD or OVERRIDE rule keywords can also contain message lines.</p>
	
	<br /><span class="subtitle">Examples</span>
	<p>Here is the contents of an example userlist:</p>
	<blockquote><code>
	ADD: MyModToAdd.esp<br />
	AFTER: LoadAfterThis.esm<br />
	APPEND: ? Adding a general comment.<br />
	APPEND: $ Incompatible with OOO!<br /><br />
	
	OVERRIDE: MyModToOverride.esp<br />
	BEFORE: LoadBeforeThis.esp<br /><br />
	
	OVERRIDE: L.A.M.E.<br />
	BEFORE: Supreme Magicka<br /><br />
	
	FOR: bgBalancingEVOptionalNPCDiversity, Vanilla.esp<br />
	REPLACE: ? This is a replacement message.<br />
	APPEND: % {{BASH:NpcFaces,NoMerge}}
	</code></blockquote>
	<p>This is the equivalent of the masterlist having:</p>
	<blockquote>
	...<br />
	LoadAfterThis.esm<br />
	MyModToAdd.esp<br />
	? Adding a general comment.<br />
	$ Incompatible with OOO!<br />
	...<br />
	MyModToOverride.esp<br />
	LoadBeforeThis.esp<br />
	...<br />
	bgBalancingEVOptionalNPCDiversity, Vanilla.esp<br />
	? This is a replacement message.<br />
	% {{BASH:NpcFaces,NoMerge}}<br />
	...<br />
	</blockquote>
	<p>The rule sorting the two groups L.A.M.E. and Supreme Magicka simply moves the L.A.M.E. group from its current position to before the Supreme Magicka group.</p>
	</div>
	</div><br /><br />
	
	<div id="apply"><span>Enforcing Your Rules</span>
	<p>When BOSS is run, it will look for your userlist at <code>Data\BOSS\userlist.txt</code>. If it is found, and the userlist contains at least one rule, BOSS will first check the syntax of the rules, and apply those with the correct syntax. 
	It will print error messages detailing the problems with any rules it skips, and success messages for the mods that are applied, into your BOSSlog.txt, in a section headed "Userlist Messages" near the top.</p>
	<p>If a rule is successfully applied, it will print one or more messages depending on what the rule does:</p>
	<ol>
		<li>If the rule includes a sort line, it will print a message of the form: <code>"<em>Mod/Group Name</em>" sorted <em>before/after</em> "<em>Mod/Group Name</em>".</code></li>
		<li>If the rule includes one or more message lines, each message line will give a message of the form: <code>"<em>Message</em>" <em>appended to/replaced</em> messages attached to "<em>Mod Name</em>".</code></li>
	</ol>
	<p>If a rule is found to have errors in its syntax or it is found to add a mod that is already in the masterlist, it will print one or more error messages depending on the type of error:</p>
	<ol>
		<li>If the rule has the correct syntax, but adds a mod that is already in the masterlist, it will print a message of the form: <code>"<em>Mod Name</em>" is already in the masterlist. Rule skipped.</code></li>
		<li>If the rule contains a keyword that is unrecognised (eg. written in lowercase, spelt wrong), it will print a message detailing the line with the error and will skip the last rule detected. If the line with the error is the first line of a new rule, that rule will also be skipped.</li>
		<li>If the rule has one or more other syntax errors, it will print a list of them under a line of the form: <code>The rule beginning "<em>First Line Of Rule</em>" has been skipped as it has the following problem(s):</code> and the error messages for each syntax error are:<div style="height:0.65em;"></div>
		<ul>
			<li>If a mod referenced is not found in your Data folder, the message will be: <code>"<em>Mod Name</em>" is not installed.</code></li>
			<li>If the rule tries to sort a mod relative to a group, or vice versa, the message will be: <code>It references a mod and a group.</code></li>
			<li>If the rule's rule keyword is FOR and it includes a sort line, the message will be: <code>It includes a sort line in a rule with a FOR rule keyword.</code></li>
			<li>If the rule's rule keyword is ADD and it references a group, the message will be: <code>It tries to add a group.</code></li>
			<li>If the rule references a group and contains a message line, the message will be: <code>It tries to attach a message to a group.</code></li>
			<li>If the rule's rule group is "ESMs", the message will be: <code>It tries to sort the group "ESMs".</code></li>
			<li>If the rule's sort keyword is BEFORE and the sort group is "ESMs", the message will be: <code>It tries to sort a group before the group "ESMs".</code></li>
			<li>If the rule's rule mod is your game's master .ESM file and the rule contains a sort line, the message will be: <code>It tries to sort the master .ESM file.</code></li>
			<li>If the rule's sort keyword is BEFORE and the sort mod is your game's master .ESM file, the message will be: <code>It tries to sort a mod before the master .ESM file.</code></li>
		</ul>
		</li>
	</ol>
	<p><b>Rule application does not alter your masterlist.txt or userlist.txt.</b> This means that if you want to undo the application of
	a rule, all you need to do is remove it from your userlist.txt and re-run BOSS.</p>
	</div><br /><br />
	
	<div id="notes"><span>Further Notes On Rules</span>
	<p>While the <em>Rule Definition Syntax</em> section gave you most of the rules of defining rules, here are some further general notes on defining rules that may 
	not be evident.</p>
	<ol>
		<li>You do not need to have blank lines between your rules, though it is neater and easier to read, especially when you have lots of rules.</li>
		<li>The names of mods and groups are not case-sensitive.</li>
		<li>You cannot sort the group "ESMs", or sort another group before it, as this group must always load first.</li>
		<li>You cannot sort the game's master ESM file, or sort another mod before it, as this must always load first.</li>
		<li>Keywords <b>must</b> be written in BLOCK CAPITALS (all the letters must be uppercase). If a keyword is not written this way, it will not be recognised, and the rule it belongs to (and perhaps the previous rule) will be skipped.</li>
		<li><b>All mods referenced in rules must be in your Data folder.</b> If a mod is not installed when BOSS is run, the rule it is part of will not be applied.</li>
		<li><b>You must never add a mod or sort a group more than once</b>. When using multiple rules sorting groups, make sure none of the groups you are sorting are located inside any of the other groups you are sorting.</li>
		<li>Rules are applied to mods ghosted by Wrye Bash. Ghosted files will be treated no different from non-ghosted files, and can be referenced in rules with their ".ghost" extension or without it.</li>
		<li>
			<b>Rules are applied in the order they are listed</b>. This means that you can have several rules loading different rule mods or groups before or 
			after the same sort mod or group, eg:<br />
			<blockquote><code>
			ADD: Mod3.esp<br />
			AFTER: RTT.esp<br /><br />
			ADD: Mod5.esp<br />
			AFTER: RTT.esp<br /><br />
			ADD: Mod1.esp<br />
			BEFORE: RTT.esp<br /><br />
			ADD: Mod4.esp<br />
			AFTER: RTT.esp<br /><br />
			ADD: Mod2.esp<br />
			BEFORE: RTT.esp
			</code></blockquote>
			will give an order of:
			<blockquote>Mod1.esp<br />
			Mod2.esp<br />
			RTT.esp<br />
			Mod4.esp<br />
			Mod5.esp<br />
			Mod3.esp</blockquote>
		</li>
		<li>
			Because rules are applied in the order they are listed, you can have rules sorting mods relative to mods which are sorted in other rules. For example:
			<blockquote><code>
			ADD: Mod1.esp<br />
			BEFORE: LoadBeforeThis.esp<br /><br />
			OVERRIDE: xulAspenWood.esp<br />
			AFTER: Mod1.esp<br /><br />
			ADD: Mod2.esp<br />
			BEFORE: Mod1.esp
			</code></blockquote>
			which will order the mods as:
			<blockquote>Mod2.esp<br />
			Mod1.esp<br />
			xulAspenWood.esp<br />
			LoadBeforeThis.esp</blockquote>
			Take care when writing such rules though, 
			as a small difference in the order of the rules in your userlist can have a very large difference on the resulting load order.
		</li>
		<li>When sorting mods relative to other mods also sorted by rules, be sure to <b>never sort relative to a mod that has not yet been added</b>. Otherwise, the mods that you sort will simply appear at the end of your load order.</li>
	</ol>
	</div><br /><br />
	
	<div id="messages"><span>The BOSS Message Format</span>
	<p>Understanding the BOSS message format is important if you wish to edit mods' messages. Each of the seven message types begins with a 
	<em>symbol code</em> that signifies what type of message it is, and then the message itself follows it. The message is just a standard line of text. 
	In addition, Bash Tag suggestion comments also have a special syntax for the suggestions they include. The symbol codes for the different message 
	types are:</p>
	<p class="definition">%&nbsp;&nbsp;&nbsp;&nbsp;Bash Tag Suggestion</p>
	<p class="definition">?&nbsp;&nbsp;&nbsp;&nbsp;General Comment</p>
	<p class="definition">*&nbsp;&nbsp;&nbsp;&nbsp;Critical FCOM Install Error</p>
	<p class="definition">:&nbsp;&nbsp;&nbsp;&nbsp;Installation Requirement</p>
	<p class="definition">"&nbsp;&nbsp;&nbsp;&nbsp;Specific Incompatibility</p>
	<p class="definition">$&nbsp;&nbsp;&nbsp;&nbsp;OOO specific comment. This will only be displayed if the user has OOO in their load order.</p>
	<p class="definition">^&nbsp;&nbsp;&nbsp;&nbsp;Better Cities specific comment. This will only be displayed if the user has Better Cities in their load order.</p>
	<p>The syntax for a Bash Tag suggestion is:<br /><br />
	% {{BASH:list suggested tags separated by commas here}} you may also have some text here.</p>
	<p>For example:</p>
	<blockquote><code>% {{BASH:Names,Graphics}} to prevent changes being lost when using overhauls.</code></blockquote>
	</div><br /><br />
	
	<div id="bomm"><span>Compatibility With BOSS Master List Manager (BOMM)</span>
	<p>Compatibility with BOMM has not been tested. However, as BOMM includes similar functionality, it would be advisable to only use one method of implementing user 
	rules. If you decide to use both, preliminary observations show that due to BOMM rules altering the masterlist.txt and running before BOSS rules, the following occurs:</p>
	<ol>
		<li>All BOMM rules are applied.</li>
		<li>If BOMM and BOSS both add a mod, the BOSS rule will be ignored, since BOMM already added it.</li>
		<li>If BOMM and BOSS both override a mod position, the BOSS rule would override the changes made by the BOMM rule, and the mod would be moved to the BOSS position.</li>
		<li>If BOMM and BOSS both append message(s) to a mod, all the BOMM and BOSS messages are applied, but BOSS messages are only visible in BOSSlog (as usual), whereas BOMM messages are visible in the masterlist too (as usual).</li>
		<li>If BOMM and BOSS both override messages attached to a mod, the BOSS message overrides the BOMM message, though the BOMM message is still visible in the masterlist.</li>
	</ol>
	<div><br /><br />
	</body>
</html>